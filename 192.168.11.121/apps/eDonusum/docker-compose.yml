version: "3"

services:

  # -- Authentication & System Management
  # -------------------------------------------------

  # generates NettyApps edonusumtest Authorization Api site
  netty-edonusumtest-login:
    image: registry.nettyapps.com.tr/netty/restapi/authorization:latest
    container_name: netty-edonusumtest-login
    environment:
      - CONNECTION_STRING=${DB_CONNECTION_STRING}
      - MAXWRONGTRY=5
      - TIMEOUTDURATION=90
      - TZ=Europe/Istanbul
      - REDIS_CONNECTION=netty-redis:6379,password=nâ‚¬tty
      - REDIS_INSTANCE=edonusumtest_
    depends_on:
      - netty-redis
    ports:
      - 8421:80
      - 28421:443
    cap_add:
      - "NET_BIND_SERVICE"
    volumes:
      - /home/nettyadmin5/nettyapps/apps/eDonusum/cnf/openssl.cnf:/etc/ssl/openssl.cnf:ro
      - ./logs/login:/app/logs/        
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps edonusumtest Admin site
  netty-edonusumtest-admin:
    image: registry.nettyapps.com.tr/netty/angular/admin-portal:latest
    container_name: netty-edonusumtest-admin
    environment:
      - API_URL=https://edonusumtest.nettyapps.com/adminapi
      - ADMIN_URL=https://edonusumtest.nettyapps.com/login
      - BASE_HREF=/admin/
      - APPLICATION=AdminPortal
      - TZ=Europe/Istanbul
    ports:
      - 8422:80
      - 28422:443
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps edonusumtest Admin Api site
  netty-edonusumtest-adminapi:
    image: registry.nettyapps.com.tr/netty/restapi/admin-portal:latest
    container_name: netty-edonusumtest-adminapi
    environment:
      - CONNECTION_STRING=${DB_CONNECTION_STRING}
      - MAXWRONGTRY=5
      - TIMEOUTDURATION=90
      - TZ=Europe/Istanbul
    ports:
      - 8423:80
      - 28423:443
    volumes:
      - ./logs/admin:/app/logs/        
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # -- edonusumtest Solution
  # -------------------------------------------------

  # generates NettyApps edonusumtest Angular site
  netty-edonusumtest-edonusum:
    image: registry.nettyapps.com.tr/netty/angular/edonusum:test
    container_name: netty-edonusumtest-edonusum
    environment:
      - API_URL=https://edonusumtest.nettyapps.com/edonusumapi
      - ADMIN_URL=https://edonusumtest.nettyapps.com/login
      - BASE_HREF=/edonusum/
      - APPLICATION=edonusum
      - TZ=Europe/Istanbul
    ports:
      - 8424:80
      - 28424:443
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps edonusumtest Api site
  netty-edonusumtest-edonusumapi:
    image: registry.nettyapps.com.tr/netty/restapi/edonusum:test
    container_name: netty-edonusumtest-edonusumapi
    environment:
      - CONNECTION_STRING=${DB_CONNECTION_STRING}
      - MAXWRONGTRY=5
      - TIMEOUTDURATION=90
      - TZ=Europe/Istanbul
      #- LOGO_PBURI=https://pb.elogo.com.tr/postboxservice.svc
      # - SOVOS_EINVOICEURI=https://efaturaws.fitbulut.com/ClientEInvoiceServices/ClientEInvoiceServicesPort.svc
      - TAXPAYER_URI="https://tools.nettyapps.com/taxpayertest/"
      - TAXPAYER_USER="netty"
      - TAXPAYER_PASSWORD="pass123"
      - PDFLINK="https://tools.nettyapps.com/xmltopdf/"
  #    - APPLICATION=edonusum
    ports:
      - 8425:80
      - 28425:443
    volumes:
    #  - ./app_data/logs:/app/logs/
      - ./logs/edonusum:/app/logs/
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

#  # Redis Part
#  netty-redis:
#    image: redis:latest
#    container_name: netty-redis
#    # volumes:
#    #   - redis_volume_data:/data
#    ports:
#      - 6379:6379
#    restart: always

networks:
   netty-network:
     name: netty-network
     external: true
     driver: bridge
