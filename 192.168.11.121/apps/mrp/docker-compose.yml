version: "3"

services:

# Proxies requests to internal services

  # generates NettyApps MRP Admin site
  netty-live-mrp-admin:
    image: registry.nettyapps.com.tr/netty/angular/admin-portal:latest
    container_name: netty-live-mrp-admin
    environment:
      - API_URL=https://mrp.nettyapps.com/adminapi
      - ADMIN_URL=https://mrp.nettyapps.com/login
      - BASE_HREF=/admin/
      - APPLICATION=AdminPortal
      - TZ=Europe/Istanbul
    ports:
      - 8890:80 
      - 28890:443
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps mrp Admin Api site
  netty-live-mrp-adminapi:
    image: registry.nettyapps.com.tr/netty/restapi/admin-portal:latest
    container_name: netty-live-mrp-adminapi
    environment:
      - CONNECTION_STRING=${DB_CONNECTION_STRING}
      - MAXWRONGTRY=5
      - TIMEOUTDURATION=90
      - TZ=Europe/Istanbul
    depends_on:
      - netty-redis
    ports:
      - 8891:80
      - 28891:443
    volumes:
      - ./logs/admin:/app/logs/            
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps mrp Authorization Api site
  netty-live-mrp-login:
    image: registry.nettyapps.com.tr/netty/restapi/authorization:latest
    container_name: netty-live-mrp-login
    environment:
      - CONNECTION_STRING=${DB_CONNECTION_STRING}
      - MAXWRONGTRY=5
      - TIMEOUTDURATION=90
      - TZ=Europe/Istanbul
      - REDIS_CONNECTION=netty-redis:6379,password=nâ‚¬tty
      - REDIS_INSTANCE=Mrp_
    ports:
      - 8892:80
      - 28892:443
    volumes:
      - ./logs/login:/app/logs/
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps mrp Angular site
  netty-live-mrp:
    image: registry.nettyapps.com.tr/netty/angular/mrp:latest
    container_name: netty-live-mrp
    environment:
      - API_URL=https://mrp.nettyapps.com/mrpapi
      - ADMIN_URL=https://mrp.nettyapps.com/login
      - BASE_HREF=/mrp/
      - APPLICATION=mrp
      - TZ=Europe/Istanbul
    ports:
      - 8893:80
      - 28893:443
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

  # generates NettyApps mrp Api site
  netty-live-mrpapi:
    image: registry.nettyapps.com.tr/netty/restapi/mrp:latest
    container_name: netty-live-mrpapi
    environment:
      - CONNECTION_STRING=${DB_CONNECTION_STRING}
      - MAXWRONGTRY=5
      - TIMEOUTDURATION=90
      - TZ=Europe/Istanbul
      - APPLICATION=mrp
    ports:
      - 8894:80
      - 28894:443
    volumes:
      - ./logs/mrp:/app/logs/
    cap_add:
      - "NET_BIND_SERVICE"
    restart: unless-stopped
    networks:
      - netty-network

#  # Redis Part
#  netty-redis-mrp:
#    image: redis:latest
#    container_name: netty-redis-mrp
#    # volumes:
#    #   - redis_volume_data:/data
#    command: --port 6380
#    ports:
#      - 6380:6380
#    restart: always

networks:
   netty-network:
     name: netty-network
     external: true
     driver: bridge
